# Activity工作流

## 一、 什么是工作流

　　以请假为例，现在大多数公司的请假流程是这样的

　　员工打电话（或网聊）向上级提出请假申请——上级口头同意——上级将请假记录下来——月底将请假记录上交公司——公司将请假录入电脑

　　采用工作流技术的公司的请假流程是这样的

　　员工使用账户登录系统——点击请假——上级登录系统点击允许

　　就这样，一个请假流程就结束了

　　有人会问，那上级不用向公司提交请假记录？公司不用将记录录入电脑？答案是，用的。但是这一切的工作都会在上级点击允许后自动运行！

　　这就是工作流技术。

## 二、 工作流技术的优点 


　　从上面的例子，很容易看出

　　工作流系统，实现了工作流程的自动化，提高了企业运营效率、改善企业资源利用、提高企业运作的灵活性和适应性、提高量化考核业务处理的效率、减少浪费（时间就是金钱）。

　　而手工处理工作流程，一方面无法对整个流程状况进行有效跟踪、了解，另一方面难免会出现人为的失误和时间上的延时导致效率低下，特别是无法进行量化统计，不利于查询、报表及绩效评估

## 三、 Activity工作流学习要点

- 1个插件

　　在Eclipse中安装Activity插件，让你可以在Eclipse中绘制Activity工作流图

-  1个引擎


　　ProcessEngine对象，Activity工作流引擎。这是Activiti工作的核心。负责生成流程运行时的各种实例及数据、监控和管理流程的运行。

　　所有的操作都是从获取引擎开始的，所以一般会把引擎作为全局变量

```java
ProcessEngine processEngine =ProcessEngines.getDefaultProcessEngine();
```

- 1个配置文件

　　activiti.cfg.xml。Activiti核心配置文件，配置流程引擎创建工具的基本参数和数据库连接池参数

- 5种数据库表

　　Activiti的后台是有数据库的支持，所有的表都以ACT_开头。 第二部分是表示表的用途的两个字母标识。用途也和服务的API对应。

　　

```
ACT_RE_*: ‘RE’表示repository。 这个前缀的表包含了流程定义和流程静态资源（图片，规则，等等）。
ACT_RU_*: ‘RU’表示runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti只在流程实例执行过程中保存这些数据，在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。
ACT_ID_*: ‘ID’表示identity。 这些表包含身份信息，比如用户，组等等。
ACT_HI_*: ‘HI’表示history。 这些表包含历史数据，比如历史流程实例，变量，任务等等。
ACT_GE_*: 通用数据，用于不同场景下，如存放资源文件
```



- 5项Service

　

```
RepositoryService：流程仓库Service，用于管理流程仓库，例如部署，删除，读取流程资源； 
IdentifyService：身份Service，可以管理和查询用户、组之间的关系； 
RuntimeService：运行时Service，可以处理所有正在运行状态的流程实例、任务等； 
TaskService：任务Service，用于管理、查询任务，例如签收，办理，指派等； 
FormService：表单Service，用于读取和流程、任务相关的数据表单； 
HistoryService：历史Service，可以查询所有历史数据，例如流程实例、任务、活动、变量、附件等； 
ManagementService：引擎管理Service，和具体业务无关，主要是可以查询引擎配置、数据、作业等。 
```

​        以上的Service接口都是Activiti封装好的，底层实现都是通过Mybatis转化为对28张表的操作，应用程序中经常会用到以上的Service，功能十分强大。

- 7项基本操作

　　　

```
设计流程图（各种组件，如连线、用户任务、网关）
流程定义增删改查
流程变量增删改查
启动流程定义
任务增删改查
完成任务
历史信息查询
```

## 四、Activiti 工作流生命周期

​    在Activiti中，工作流的生命周期主要包含以下几个方面：

```
1.设计流程模型，生成流程资源
2.根据流程模型生成流程定义
3.配置工作流人员
4.根据流程定义启动流程生成流程实例
5.流程实例由一系列任务实例构成，任务自动流转
6.修改流程模型，发布新的流程版本优化流程
```

